<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mental Wellness · Light</title>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#e8ddd4}

#veil{
  position:fixed;inset:0;z-index:300;
  background:#f0ebe4;opacity:0;pointer-events:none;
  transition:opacity 3.2s cubic-bezier(0.4,0,0.2,1);
}
#veil.fade{opacity:1}

.layer{position:fixed;inset:0;z-index:1;pointer-events:none;opacity:0;transition:opacity 0.6s ease}
.layer.active{opacity:1}

#aurora{
  position:fixed;inset:0;z-index:2;
  overflow:hidden;pointer-events:none;
  mix-blend-mode:multiply;
}
.blob{
  position:absolute;border-radius:50%;
  filter:blur(120px);opacity:0.42;
  will-change:transform;
  transition:background 5s ease,width 5s ease,height 5s ease;
}

.pLayer{position:fixed;inset:0;z-index:4;pointer-events:none;opacity:0;transition:opacity 1.8s ease}
.pLayer.active{opacity:1}

#vig{
  position:fixed;inset:0;z-index:9;pointer-events:none;
  background:radial-gradient(ellipse at center,transparent 48%,rgba(0,0,0,0.06) 100%);
}

.grain{
  position:fixed;inset:-50%;width:200%;height:200%;
  z-index:10;pointer-events:none;opacity:0.025;
  animation:gS .6s steps(2) infinite;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)'/%3E%3C/svg%3E");
}
@keyframes gS{0%{transform:translate(0,0)}33%{transform:translate(-4%,4%)}66%{transform:translate(4%,-3%)}}

#breath{
  position:fixed;left:50%;bottom:9vh;
  transform:translateX(-50%);
  z-index:20;width:52px;height:52px;
}
.br{
  position:absolute;inset:0;border-radius:50%;
  border:1px solid rgba(140,120,100,0.4);opacity:0;
  animation:bR 9s ease-out infinite;
  transition:border-color 3s ease;
}
.br:nth-child(1){animation-delay:0s}
.br:nth-child(2){animation-delay:3s}
.br:nth-child(3){animation-delay:6s}
@keyframes bR{0%{transform:scale(1);opacity:.55}100%{transform:scale(6.5);opacity:0}}
.bc{
  position:absolute;inset:16px;border-radius:50%;
  animation:bP 9s ease-in-out infinite;
  transition:background 3s,box-shadow 3s;
}
@keyframes bP{0%,100%{transform:scale(1)}42%{transform:scale(1.6)}56%{transform:scale(1.6)}}

/* ── particle keyframes ── */
@keyframes petalFall{
  0%  {transform:translateY(0) rotate(0deg) translateX(0);opacity:0}
  6%  {opacity:.80}
  30% {transform:translateY(26vh) rotate(115deg) translateX(26px)}
  65% {transform:translateY(60vh) rotate(248deg) translateX(-18px)}
  93% {opacity:.50}
  100%{transform:translateY(112vh) rotate(388deg) translateX(13px);opacity:0}
}
@keyframes petalDrift{
  0%  {transform:translateY(0) rotate(0deg);opacity:0}
  7%  {opacity:.72}
  50% {transform:translateY(50vh) rotate(175deg) translateX(-32px)}
  100%{transform:translateY(115vh) rotate(335deg) translateX(16px);opacity:0}
}
@keyframes floatUp{
  0%  {transform:translateY(0) translateX(0) scale(.4);opacity:0}
  9%  {opacity:.75}
  45% {transform:translateY(-36vh) translateX(14px) scale(1)}
  90% {opacity:.38}
  100%{transform:translateY(-96vh) translateX(-10px) scale(1.1);opacity:0}
}
@keyframes driftMote{
  0%  {transform:translate(0,0);opacity:0}
  12% {opacity:.65}
  50% {transform:translate(18px,-38vh)}
  100%{transform:translate(-12px,-88vh);opacity:0}
}
@keyframes leafSpin{
  0%  {transform:translateY(0) rotate(0deg) translateX(0);opacity:0}
  6%  {opacity:.72}
  50% {transform:translateY(46vh) rotate(196deg) translateX(28px)}
  100%{transform:translateY(112vh) rotate(412deg) translateX(-17px);opacity:0}
}
@keyframes snowFall{
  0%  {transform:translateY(0) translateX(0) rotate(0deg);opacity:0}
  5%  {opacity:.78}
  50% {transform:translateY(50vh) translateX(20px) rotate(180deg)}
  100%{transform:translateY(112vh) translateX(-14px) rotate(355deg);opacity:0}
}
@keyframes raindrop{
  0%  {transform:translateY(0);opacity:0}
  4%  {opacity:.65}
  100%{transform:translateY(112vh);opacity:0}
}
@keyframes rippleOut{
  0%  {transform:scale(0.1);opacity:.55}
  100%{transform:scale(5.5);opacity:0}
}
@keyframes mistDrift{
  0%  {transform:translateX(-8vw);opacity:0}
  10% {opacity:.6}
  100%{transform:translateX(112vw);opacity:0}
}
@keyframes sporeRise{
  0%  {transform:translateY(0) translateX(0) scale(.3);opacity:0}
  8%  {opacity:.70}
  40% {transform:translateY(-32vh) translateX(16px) scale(1)}
  70% {transform:translateY(-60vh) translateX(-11px)}
  95% {opacity:.30}
  100%{transform:translateY(-95vh) translateX(8px);opacity:0}
}
@keyframes emberFloat{
  0%  {transform:translateY(0) translateX(0);opacity:0}
  8%  {opacity:.85}
  50% {transform:translateY(-35vh) translateX(12px)}
  100%{transform:translateY(-85vh) translateX(-8px);opacity:0}
}
</style>
</head>
<body>

<div id="veil"></div>
<canvas class="layer active" id="c0"></canvas>
<canvas class="layer" id="c1"></canvas>
<canvas class="layer" id="c2"></canvas>
<canvas class="layer" id="c3"></canvas>
<canvas class="layer" id="c4"></canvas>

<div id="aurora">
  <div class="blob" id="b0"></div><div class="blob" id="b1"></div>
  <div class="blob" id="b2"></div><div class="blob" id="b3"></div>
  <div class="blob" id="b4"></div>
</div>

<div class="pLayer active" id="p0"></div>
<div class="pLayer" id="p1"></div>
<div class="pLayer" id="p2"></div>
<div class="pLayer" id="p3"></div>
<div class="pLayer" id="p4"></div>

<div id="vig"></div>
<div class="grain"></div>

<div id="breath">
  <div class="br"></div><div class="br"></div><div class="br"></div>
  <div class="bc" id="bc"></div>
</div>

<script>
function rgba(r,g,b,a){return `rgba(${r},${g},${b},${a})`}

const MOTES=Array.from({length:90},()=>({
  x:Math.random(),y:Math.random(),
  sz:Math.random()*2.5+0.4,
  spd:0.00028+Math.random()*0.00055,
  ph:Math.random()*Math.PI*2,
  dx:(Math.random()-0.5)*0.00012,
}));

// ══════════════════════════════════════════════════════════════
// THEMES — muted, scenery-rich, pleasant but not blinding
// ══════════════════════════════════════════════════════════════
const THEMES=[

// ── 0 · SAKURA TWILIGHT ────────────────────────────────────
// Dusty rose-mauve dusk, dark branch silhouettes, falling petals
{
  name:'sakura-twilight',
  bg:'#d9ccd4',
  blobs:[rgba(195,168,178,0.52),rgba(180,158,168,0.46),rgba(205,175,185,0.44),rgba(188,162,172,0.50),rgba(178,155,165,0.38)],
  blobSizes:['72vw','60vw','66vw','46vw','52vw'],
  blobPos:[{top:'-14%',left:'-18%'},{top:'35%',right:'-10%'},{bottom:'-12%',left:'16%'},{top:'6%',left:'38%'},{top:'48%',left:'-5%'}],
  dotColor:'#a06878',dotGlow:rgba(160,104,120,0.28),ringColor:'#b07888',
  drawFn(ctx,W,H,t,mx,my){
    ctx.clearRect(0,0,W,H);

    // 1. Layered dusk sky — dusty rose to deep mauve
    const sky=ctx.createLinearGradient(0,0,0,H);
    sky.addColorStop(0,  rgba(168,142,158,1));
    sky.addColorStop(0.35,rgba(188,160,172,1));
    sky.addColorStop(0.65,rgba(205,180,188,1));
    sky.addColorStop(1,  rgba(215,200,205,1));
    ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);

    // 2. Setting sun glow — low, diffuse
    const sg=ctx.createRadialGradient(W*0.68+mx*16,H*0.52+my*8,0,W*0.68,H*0.52,H*0.60);
    sg.addColorStop(0,rgba(220,175,155,0.28));
    sg.addColorStop(0.4,rgba(210,160,140,0.12));
    sg.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=sg; ctx.fillRect(0,0,W,H);

    // 3. Rolling hills silhouette
    ctx.save();
    // far hill — lighter
    ctx.fillStyle=rgba(148,118,132,0.45);
    ctx.beginPath(); ctx.moveTo(0,H);
    const fh=[0,0.18,0.38,0.58,0.78,0.92,1.0];
    const fy=[0.82,0.60,0.70,0.55,0.65,0.70,0.82];
    fh.forEach((px,i)=>ctx.lineTo(W*px+mx*5,H*fy[i]));
    ctx.lineTo(W,H); ctx.closePath(); ctx.fill();
    // near hill — darker
    ctx.fillStyle=rgba(118,90,105,0.55);
    ctx.beginPath(); ctx.moveTo(0,H);
    const nh=[0,0.12,0.28,0.46,0.62,0.80,0.94,1.0];
    const ny=[0.90,0.72,0.80,0.65,0.74,0.78,0.72,0.90];
    nh.forEach((px,i)=>ctx.lineTo(W*px+mx*8,H*ny[i]));
    ctx.lineTo(W,H); ctx.closePath(); ctx.fill();
    ctx.restore();

    // 4. Foreground ground plane
    const gnd=ctx.createLinearGradient(0,H*0.78,0,H);
    gnd.addColorStop(0,'rgba(0,0,0,0)');
    gnd.addColorStop(1,rgba(95,72,88,0.35));
    ctx.fillStyle=gnd; ctx.fillRect(0,0,W,H);

    // 5. Cherry tree branches — recursive, dark silhouette
    ctx.save();
    const drawBranch=(x,y,len,ang,depth,lw)=>{
      if(depth<=0||len<10)return;
      const sway=Math.sin(t*0.000022+depth*0.7+x*0.0008)*0.05;
      const ex=x+Math.cos(ang+sway)*len;
      const ey=y+Math.sin(ang+sway)*len;
      ctx.lineWidth=lw;
      ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(ex,ey); ctx.stroke();
      drawBranch(ex,ey,len*0.68,ang-0.38,depth-1,lw*0.68);
      drawBranch(ex,ey,len*0.70,ang+0.40,depth-1,lw*0.68);
      if(depth>2) drawBranch(ex,ey,len*0.55,ang+0.10,depth-2,lw*0.50);
    };
    ctx.strokeStyle=rgba(55,38,48,0.75);
    ctx.lineCap='round';
    drawBranch(W*0.10+mx*8, H*0.88, H*0.26,-Math.PI/2-0.15,7,3.2);
    ctx.strokeStyle=rgba(55,38,48,0.65);
    drawBranch(W*0.88+mx*8, H*0.85, H*0.20,-Math.PI/2+0.22,6,2.6);
    drawBranch(W*0.50+mx*8, H*1.00, H*0.30,-Math.PI/2+0.05,7,2.8);
    ctx.restore();

    // 6. Blossom glow halos on branch tips
    ctx.save();
    for(let cl=0;cl<26;cl++){
      const bx=W*(0.04+cl*0.038)+Math.sin(t*0.000020+cl*1.1)*W*0.020+mx*10;
      const by=H*(0.12+((cl*41)%7)*0.085)+Math.cos(t*0.000016+cl*0.8)*H*0.022;
      const br=16+cl%6*7;
      const ba=0.045+Math.sin(t*0.000038+cl*1.3)*0.025;
      const bg=ctx.createRadialGradient(bx,by,0,bx,by,br);
      bg.addColorStop(0,`rgba(230,195,205,${ba})`);
      bg.addColorStop(1,'rgba(0,0,0,0)');
      ctx.fillStyle=bg; ctx.beginPath(); ctx.arc(bx,by,br,0,Math.PI*2); ctx.fill();
    }
    ctx.restore();

    // 7. Ground mist
    const mist=[
      {col:rgba(190,168,178,0.20),a:0.018,f:0.0010,sp:0.000035,y:0.82},
      {col:rgba(200,178,186,0.14),a:0.013,f:0.0014,sp:0.000026,y:0.88},
      {col:rgba(210,190,196,0.10),a:0.010,f:0.0008,sp:0.000042,y:0.93},
    ];
    mist.forEach((w,i)=>{
      const by=H*w.y+my*10;
      ctx.beginPath(); ctx.moveTo(0,H);
      for(let x=0;x<=W;x+=3){
        const y=by+Math.sin(x*w.f+t*w.sp*1000+i)*H*w.a;
        ctx.lineTo(x,y);
      }
      ctx.lineTo(W,H); ctx.closePath();
      ctx.fillStyle=w.col; ctx.fill();
    });

    // 8. Distant birds — tiny V shapes drifting
    ctx.save(); ctx.strokeStyle=rgba(55,38,48,0.28); ctx.lineWidth=0.8;
    for(let b=0;b<8;b++){
      const bx=((b*W*0.13+t*0.018+b*50)%(W*1.2))-W*0.1+mx*5;
      const by=H*(0.14+((b*37)%5)*0.05)+Math.sin(t*0.000028+b)*H*0.012;
      const bs=4+b%3*2;
      ctx.beginPath();
      ctx.moveTo(bx-bs,by+bs*0.4);
      ctx.lineTo(bx,by);
      ctx.lineTo(bx+bs,by+bs*0.4);
      ctx.stroke();
    }
    ctx.restore();

    // 9. Pollen motes
    ctx.save();
    MOTES.forEach((m,i)=>{
      if(i>55)return;
      const fl=Math.sin(t*m.spd+m.ph)*0.5+0.5;
      const px=(m.x+t*m.dx*0.3)%1;
      const py=(m.y+Math.sin(t*m.spd*0.5+m.ph)*0.03)%1;
      ctx.beginPath(); ctx.arc(px*W,py*H,m.sz*0.75,0,Math.PI*2);
      ctx.fillStyle=`rgba(210,178,190,${fl*0.45})`;
      ctx.fill();
    });
    ctx.restore();
  }
},

// ── 1 · MISTY FOREST ───────────────────────────────────────
// Sage-green morning, layered fog, tall pine silhouettes, spores
{
  name:'misty-forest',
  bg:'#c8d4c8',
  blobs:[rgba(158,178,155,0.50),rgba(145,168,142,0.44),rgba(168,185,165,0.42),rgba(152,172,150,0.48),rgba(140,162,138,0.36)],
  blobSizes:['74vw','62vw','68vw','48vw','54vw'],
  blobPos:[{top:'-16%',left:'-20%'},{top:'36%',right:'-10%'},{bottom:'-14%',left:'16%'},{top:'5%',left:'38%'},{top:'48%',left:'-5%'}],
  dotColor:'#5a8060',dotGlow:rgba(90,128,96,0.28),ringColor:'#6a9070',
  drawFn(ctx,W,H,t,mx,my){
    ctx.clearRect(0,0,W,H);

    // 1. Layered misty sky — sage to warm grey
    const sky=ctx.createLinearGradient(0,0,0,H);
    sky.addColorStop(0,  rgba(148,162,148,1));
    sky.addColorStop(0.40,rgba(168,180,162,1));
    sky.addColorStop(0.72,rgba(182,194,175,1));
    sky.addColorStop(1,  rgba(195,208,188,1));
    ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);

    // 2. Dawn light seeping through canopy — top centre
    const dawn=ctx.createRadialGradient(W*0.50+mx*14,H*0.02+my*6,0,W*0.50,H*0.05,H*0.65);
    dawn.addColorStop(0,rgba(220,215,185,0.22));
    dawn.addColorStop(0.5,rgba(200,195,165,0.08));
    dawn.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=dawn; ctx.fillRect(0,0,W,H);

    // 3. Far forest — very faint, foggy
    ctx.save();
    ctx.fillStyle=rgba(128,148,125,0.30);
    ctx.beginPath(); ctx.moveTo(0,H);
    for(let tx=0;tx<=W;tx+=W*0.04){
      const th2=H*(0.28+Math.sin(tx*0.0025+0.5)*0.08);
      ctx.lineTo(tx,H*0.70-th2);
      ctx.lineTo(tx+W*0.02,H*0.70);
    }
    ctx.lineTo(W,H); ctx.closePath(); ctx.fill();
    ctx.restore();

    // 4. Mid forest — pine silhouettes
    ctx.save();
    ctx.fillStyle=rgba(88,112,85,0.52);
    const pineCount=18;
    for(let p=0;p<pineCount;p++){
      const px=W*(p/pineCount)+W*0.03+Math.sin(t*0.000015+p)*W*0.002+mx*6;
      const ph2=H*(0.22+((p*31)%10)*0.025);
      const pw=W*0.028+((p*13)%5)*W*0.006;
      // pine triangles stacked
      for(let lv=0;lv<4;lv++){
        const ly=H*0.80-ph2*(0.2+lv*0.22);
        const lw2=pw*(1.8-lv*0.28);
        ctx.beginPath();
        ctx.moveTo(px,ly-ph2*0.22);
        ctx.lineTo(px-lw2,ly+ph2*0.08);
        ctx.lineTo(px+lw2,ly+ph2*0.08);
        ctx.closePath(); ctx.fill();
      }
      // trunk
      ctx.fillRect(px-pw*0.18,H*0.80,pw*0.36,H*0.20);
    }
    ctx.restore();

    // 5. Near large trees — darker
    ctx.save();
    ctx.fillStyle=rgba(58,78,55,0.68);
    const near=[{x:0.04,h:0.52,w:0.022},{x:0.22,h:0.46,w:0.018},{x:0.78,h:0.50,w:0.020},{x:0.95,h:0.44,w:0.016}];
    near.forEach(tr=>{
      const tx=W*tr.x+mx*10;
      const th2=H*tr.h; const tw=W*tr.w;
      for(let lv=0;lv<5;lv++){
        const ly=H-th2*(0.18+lv*0.18);
        const lw2=tw*(2.0-lv*0.25);
        ctx.beginPath();
        ctx.moveTo(tx,ly-th2*0.20);
        ctx.lineTo(tx-lw2,ly+th2*0.06);
        ctx.lineTo(tx+lw2,ly+th2*0.06);
        ctx.closePath(); ctx.fill();
      }
      ctx.fillRect(tx-tw*0.20,H*0.88,tw*0.40,H*0.12);
    });
    ctx.restore();

    // 6. Layered fog banks
    const fogs=[
      {col:rgba(185,200,182,0.32),a:0.022,f:0.0009,sp:0.000030,y:0.62},
      {col:rgba(192,206,188,0.26),a:0.018,f:0.0012,sp:0.000022,y:0.70},
      {col:rgba(198,212,194,0.22),a:0.015,f:0.0007,sp:0.000038,y:0.78},
      {col:rgba(205,218,200,0.18),a:0.012,f:0.0015,sp:0.000018,y:0.86},
      {col:rgba(210,222,205,0.14),a:0.010,f:0.0010,sp:0.000028,y:0.92},
    ];
    fogs.forEach((w,i)=>{
      const by=H*w.y+my*12;
      ctx.beginPath(); ctx.moveTo(0,H);
      for(let x=0;x<=W;x+=3){
        const y=by+Math.sin(x*w.f+t*w.sp*1000+i*0.9)*H*w.a
                +Math.sin(x*w.f*1.8+t*w.sp*700+i)*H*w.a*0.3;
        ctx.lineTo(x,y);
      }
      ctx.lineTo(W,H); ctx.closePath();
      ctx.fillStyle=w.col; ctx.fill();
    });

    // 7. Sunbeam shafts through canopy
    ctx.save(); ctx.globalCompositeOperation='overlay'; ctx.globalAlpha=0.04;
    for(let s=0;s<6;s++){
      const sx=W*(0.15+s*0.14)+mx*10;
      const sg=ctx.createLinearGradient(sx,0,sx+W*0.04,H*0.75);
      sg.addColorStop(0,rgba(220,215,180,0.9));
      sg.addColorStop(1,'rgba(0,0,0,0)');
      ctx.fillStyle=sg;
      ctx.beginPath();
      ctx.moveTo(sx-W*0.015,0);
      ctx.lineTo(sx+W*0.055,H*0.75);
      ctx.lineTo(sx+W*0.065,H*0.75);
      ctx.lineTo(sx,0);
      ctx.closePath(); ctx.fill();
    }
    ctx.restore();

    // 8. Floating spore motes
    ctx.save();
    MOTES.forEach((m,i)=>{
      if(i>60)return;
      const fl=Math.sin(t*m.spd+m.ph)*0.5+0.5;
      const px=(m.x+t*m.dx*0.4)%1;
      const py=(m.y+Math.sin(t*m.spd*0.6+m.ph)*0.035)%1;
      ctx.beginPath(); ctx.arc(px*W,py*H,m.sz*0.80,0,Math.PI*2);
      ctx.fillStyle=`rgba(180,200,175,${fl*0.48})`;
      ctx.fill();
    });
    ctx.restore();
  }
},

// ── 2 · AMBER AUTUMN ───────────────────────────────────────
// Warm ochre-amber afternoon, deciduous trees, falling leaves, haze
{
  name:'amber-autumn',
  bg:'#d4c4a8',
  blobs:[rgba(188,162,118,0.50),rgba(175,150,108,0.44),rgba(198,172,128,0.42),rgba(182,156,115,0.48),rgba(170,148,106,0.36)],
  blobSizes:['70vw','58vw','64vw','44vw','50vw'],
  blobPos:[{top:'-12%',left:'-16%'},{top:'38%',right:'-8%'},{bottom:'-10%',left:'18%'},{top:'8%',left:'40%'},{top:'50%',left:'-3%'}],
  dotColor:'#8a6030',dotGlow:rgba(138,96,48,0.28),ringColor:'#9a7040',
  drawFn(ctx,W,H,t,mx,my){
    ctx.clearRect(0,0,W,H);

    // 1. Warm amber sky
    const sky=ctx.createLinearGradient(0,0,0,H);
    sky.addColorStop(0,  rgba(172,148,105,1));
    sky.addColorStop(0.40,rgba(192,165,120,1));
    sky.addColorStop(0.70,rgba(210,185,138,1));
    sky.addColorStop(1,  rgba(222,200,155,1));
    ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);

    // 2. Low sun warmth — bottom-left
    const sg=ctx.createRadialGradient(W*0.22+mx*20,H*0.62+my*12,0,W*0.22,H*0.65,H*0.72);
    sg.addColorStop(0,rgba(225,185,110,0.30));
    sg.addColorStop(0.4,rgba(215,170,95,0.12));
    sg.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=sg; ctx.fillRect(0,0,W,H);

    // 3. Distant rolling hills — ochre
    ctx.save();
    ctx.fillStyle=rgba(142,118,82,0.42);
    ctx.beginPath(); ctx.moveTo(0,H);
    [0,0.16,0.34,0.52,0.70,0.88,1.0].forEach((px,i)=>{
      ctx.lineTo(W*px+mx*4,[0.88,0.65,0.75,0.60,0.70,0.72,0.88][i]*H);
    });
    ctx.lineTo(W,H); ctx.closePath(); ctx.fill();
    ctx.restore();

    // 4. Deciduous tree silhouettes — round canopies
    ctx.save();
    const drawTree=(tx,ty,r,layers,col)=>{
      ctx.fillStyle=col;
      // trunk
      ctx.fillRect(tx-r*0.12,ty,r*0.24,r*0.55);
      // canopy layers
      for(let lv=0;lv<layers;lv++){
        const ly=ty-r*(0.2+lv*0.28);
        const lr=r*(1.0-lv*0.18);
        ctx.beginPath(); ctx.arc(tx,ly,lr,0,Math.PI*2); ctx.fill();
      }
    };
    drawTree(W*0.08+mx*9, H*0.72, H*0.13, 3, rgba(72,52,28,0.62));
    drawTree(W*0.22+mx*9, H*0.76, H*0.10, 3, rgba(88,62,32,0.55));
    drawTree(W*0.76+mx*9, H*0.74, H*0.12, 3, rgba(72,52,28,0.60));
    drawTree(W*0.90+mx*9, H*0.78, H*0.09, 3, rgba(80,58,30,0.52));
    drawTree(W*0.50+mx*9, H*0.80, H*0.08, 2, rgba(65,48,25,0.48));
    ctx.restore();

    // 5. Leaf litter on ground
    ctx.save();
    for(let l=0;l<24;l++){
      const lx=W*(l/24)+W*0.02+Math.sin(t*0.000015+l)*W*0.005;
      const ly=H*(0.88+((l*19)%5)*0.023);
      const ls=4+l%5;
      ctx.save(); ctx.translate(lx,ly); ctx.rotate(l*0.42+t*0.000008);
      ctx.fillStyle=`hsla(${25+l%25},55%,44%,${0.22+((l*7)%4)*0.06})`;
      ctx.beginPath(); ctx.ellipse(0,0,ls,ls*0.55,0,0,Math.PI*2); ctx.fill();
      ctx.restore();
    }
    ctx.restore();

    // 6. Warm haze at horizon
    const haze=ctx.createLinearGradient(0,H*0.52,0,H*0.75);
    haze.addColorStop(0,'rgba(0,0,0,0)');
    haze.addColorStop(0.5,rgba(210,175,115,0.12));
    haze.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=haze; ctx.fillRect(0,0,W,H);

    // 7. Ground golden glow
    const gg=ctx.createLinearGradient(0,H*0.75,0,H);
    gg.addColorStop(0,'rgba(0,0,0,0)');
    gg.addColorStop(1,rgba(140,105,55,0.25));
    ctx.fillStyle=gg; ctx.fillRect(0,0,W,H);

    // 8. Crepuscular rays — very soft
    ctx.save(); ctx.globalAlpha=0.035;
    for(let r=0;r<7;r++){
      const ang=-Math.PI*0.55+(r/6)*Math.PI*0.4+t*0.0000060;
      const flicker=0.4+Math.sin(t*0.000062+r*2.1)*0.45;
      const rg=ctx.createLinearGradient(W*0.22,H*0.65,
        W*0.22+Math.cos(ang)*H*1.2,H*0.65+Math.sin(ang)*H*1.2);
      rg.addColorStop(0,`rgba(220,185,100,${0.02*flicker})`);
      rg.addColorStop(1,'rgba(0,0,0,0)');
      ctx.fillStyle=rg; ctx.fillRect(0,0,W,H);
    }
    ctx.restore();

    // 9. Motes
    ctx.save();
    MOTES.forEach((m,i)=>{
      if(i>58)return;
      const fl=Math.sin(t*m.spd+m.ph)*0.5+0.5;
      const px=(m.x+t*m.dx*0.35+Math.sin(t*m.spd*0.4+m.ph)*0.018)%1;
      const py=(m.y+Math.sin(t*m.spd*0.55+m.ph)*0.028)%1;
      ctx.beginPath(); ctx.arc(px*W,py*H,m.sz,0,Math.PI*2);
      ctx.fillStyle=`rgba(200,168,108,${fl*0.42})`;
      ctx.fill();
    });
    ctx.restore();
  }
},

// ── 3 · SILVER RAIN ────────────────────────────────────────
// Cool grey-blue overcast, rain streaks, puddle ripples, distant city
{
  name:'silver-rain',
  bg:'#c8d0d8',
  blobs:[rgba(168,182,198,0.50),rgba(158,172,188,0.44),rgba(175,188,205,0.42),rgba(162,176,192,0.48),rgba(152,168,185,0.36)],
  blobSizes:['72vw','60vw','66vw','46vw','52vw'],
  blobPos:[{top:'-14%',left:'-18%'},{top:'36%',right:'-10%'},{bottom:'-12%',left:'16%'},{top:'6%',left:'38%'},{top:'48%',left:'-5%'}],
  dotColor:'#507898',dotGlow:rgba(80,120,152,0.28),ringColor:'#608aaa',
  drawFn(ctx,W,H,t,mx,my){
    ctx.clearRect(0,0,W,H);

    // 1. Overcast sky — silver grey
    const sky=ctx.createLinearGradient(0,0,0,H);
    sky.addColorStop(0,  rgba(158,170,185,1));
    sky.addColorStop(0.45,rgba(175,186,200,1));
    sky.addColorStop(0.75,rgba(190,200,215,1));
    sky.addColorStop(1,  rgba(202,212,225,1));
    ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);

    // 2. Cloud masses — soft, layered
    ctx.save();
    const clouds=[
      {x:0.08,y:0.06,rx:0.30,ry:0.09,sp:0.0000090},
      {x:0.48,y:0.03,rx:0.36,ry:0.11,sp:-0.0000075},
      {x:0.85,y:0.08,rx:0.26,ry:0.08,sp:0.0000110},
      {x:0.28,y:0.16,rx:0.24,ry:0.07,sp:-0.0000085},
      {x:0.66,y:0.20,rx:0.28,ry:0.09,sp:0.0000095},
      {x:0.02,y:0.22,rx:0.20,ry:0.06,sp:-0.0000070},
    ];
    clouds.forEach((cl,i)=>{
      const cx2=cl.x*W+Math.sin(t*cl.sp*1000+i*1.4)*W*0.05+mx*8;
      const cy2=cl.y*H+Math.cos(t*cl.sp*800+i)*H*0.012;
      const cg=ctx.createRadialGradient(cx2,cy2,0,cx2,cy2,cl.rx*W);
      cg.addColorStop(0,rgba(175,188,205,0.50));
      cg.addColorStop(0.5,rgba(182,194,210,0.22));
      cg.addColorStop(1,'rgba(0,0,0,0)');
      ctx.fillStyle=cg; ctx.fillRect(0,0,W,H);
    });
    ctx.restore();

    // 3. Cityscape silhouette — distant buildings
    ctx.save();
    ctx.fillStyle=rgba(128,142,158,0.38);
    const buildings=[
      {x:0.02,w:0.04,h:0.16},{x:0.07,w:0.03,h:0.22},{x:0.11,w:0.05,h:0.18},
      {x:0.17,w:0.03,h:0.28},{x:0.21,w:0.04,h:0.20},{x:0.26,w:0.02,h:0.25},
      {x:0.30,w:0.06,h:0.15},{x:0.38,w:0.03,h:0.30},{x:0.42,w:0.05,h:0.18},
      {x:0.49,w:0.04,h:0.24},{x:0.55,w:0.02,h:0.32},{x:0.58,w:0.04,h:0.20},
      {x:0.64,w:0.03,h:0.28},{x:0.68,w:0.05,h:0.16},{x:0.75,w:0.03,h:0.22},
      {x:0.80,w:0.04,h:0.18},{x:0.85,w:0.02,h:0.26},{x:0.88,w:0.05,h:0.14},
      {x:0.94,w:0.03,h:0.20},{x:0.97,w:0.03,h:0.15},
    ];
    buildings.forEach(b=>{
      ctx.fillRect(W*b.x+mx*3,H*(0.58-b.h),W*b.w,H*b.h);
    });
    // windows glow
    ctx.fillStyle=rgba(220,225,235,0.18);
    buildings.forEach(b=>{
      for(let wy=0;wy<4;wy++) for(let wx=0;wx<2;wx++){
        if(Math.sin(b.x*50+wy*7+wx*3)>0.1)
          ctx.fillRect(W*b.x+W*b.w*0.2+wx*W*b.w*0.35+mx*3,
            H*(0.58-b.h)+H*b.h*(0.15+wy*0.20),W*b.w*0.22,H*b.h*0.10);
      }
    });
    ctx.restore();

    // 4. Wet road reflection
    const ref=ctx.createLinearGradient(0,H*0.72,0,H);
    ref.addColorStop(0,'rgba(0,0,0,0)');
    ref.addColorStop(0.3,rgba(168,185,205,0.22));
    ref.addColorStop(1,rgba(148,168,190,0.35));
    ctx.fillStyle=ref; ctx.fillRect(0,0,W,H);

    // 5. Rain streaks — diagonal
    ctx.save(); ctx.lineWidth=0.65;
    for(let r=0;r<70;r++){
      const rx=((r*W*0.016+t*0.14+r*30)%W);
      const ry=((r*H*0.014+t*0.28+(r%4)*H*0.26)%H);
      const rl=H*0.022+((r*9)%4)*H*0.007;
      const alpha=0.10+((r*11)%5)*0.032;
      ctx.strokeStyle=`rgba(148,168,195,${alpha})`;
      ctx.beginPath();
      ctx.moveTo(rx+mx*1.5,ry);
      ctx.lineTo(rx+rl*0.10+mx*1.5,ry+rl);
      ctx.stroke();
    }
    ctx.restore();

    // 6. Puddle ripples
    ctx.save();
    const puddles=[{x:0.18,y:0.88},{x:0.44,y:0.91},{x:0.65,y:0.86},{x:0.82,y:0.93},{x:0.32,y:0.95}];
    puddles.forEach((p,i)=>{
      for(let ring=0;ring<4;ring++){
        const phase=(t*0.00165+i*1.9+ring*2.8)%(Math.PI*2);
        const prog=Math.sin(phase)*0.5+0.5;
        const rr=(14+ring*16)*prog;
        const alpha=(1-prog)*0.16;
        ctx.beginPath();
        ctx.ellipse(p.x*W+mx*5,p.y*H+my*3,rr,rr*0.26,0,0,Math.PI*2);
        ctx.strokeStyle=`rgba(128,155,185,${alpha})`;
        ctx.lineWidth=0.65; ctx.stroke();
      }
    });
    ctx.restore();

    // 7. Mist layers
    const mist=[
      {col:rgba(175,190,210,0.22),a:0.018,f:0.0010,sp:0.000032,y:0.74},
      {col:rgba(182,196,215,0.16),a:0.013,f:0.0014,sp:0.000024,y:0.82},
      {col:rgba(190,204,220,0.12),a:0.010,f:0.0008,sp:0.000038,y:0.89},
    ];
    mist.forEach((w,i)=>{
      const by=H*w.y+my*8;
      ctx.beginPath(); ctx.moveTo(0,H);
      for(let x=0;x<=W;x+=3){
        const y=by+Math.sin(x*w.f+t*w.sp*1000+i)*H*w.a;
        ctx.lineTo(x,y);
      }
      ctx.lineTo(W,H); ctx.closePath();
      ctx.fillStyle=w.col; ctx.fill();
    });

    // 8. Moisture motes
    ctx.save();
    MOTES.forEach((m,i)=>{
      if(i>52)return;
      const fl=Math.sin(t*m.spd+m.ph)*0.5+0.5;
      const px=(m.x+Math.sin(t*m.spd*0.4+m.ph)*0.012)%1;
      const py=(m.y+t*0.000012)%1;
      ctx.beginPath(); ctx.arc(px*W,py*H,m.sz*0.65,0,Math.PI*2);
      ctx.fillStyle=`rgba(165,185,210,${fl*0.42})`;
      ctx.fill();
    });
    ctx.restore();
  }
},

// ── 4 · LAVENDER DUSK ──────────────────────────────────────
// Soft lilac-grey evening, rolling hills, fireflies emerging
{
  name:'lavender-dusk',
  bg:'#ccc4d4',
  blobs:[rgba(178,168,195,0.50),rgba(165,155,182,0.44),rgba(188,178,205,0.42),rgba(172,162,190,0.48),rgba(160,150,178,0.36)],
  blobSizes:['72vw','60vw','66vw','46vw','52vw'],
  blobPos:[{top:'-14%',left:'-18%'},{top:'36%',right:'-10%'},{bottom:'-12%',left:'16%'},{top:'6%',left:'38%'},{top:'48%',left:'-5%'}],
  dotColor:'#7860a0',dotGlow:rgba(120,96,160,0.28),ringColor:'#8870b0',
  drawFn(ctx,W,H,t,mx,my){
    ctx.clearRect(0,0,W,H);

    // 1. Dusk gradient — lilac to dusty violet
    const sky=ctx.createLinearGradient(0,0,0,H);
    sky.addColorStop(0,  rgba(148,138,168,1));
    sky.addColorStop(0.38,rgba(168,158,188,1));
    sky.addColorStop(0.68,rgba(185,175,200,1));
    sky.addColorStop(1,  rgba(198,190,212,1));
    ctx.fillStyle=sky; ctx.fillRect(0,0,W,H);

    // 2. Last light on horizon — warm amber sliver
    const hor=ctx.createLinearGradient(0,H*0.52,0,H*0.70);
    hor.addColorStop(0,'rgba(0,0,0,0)');
    hor.addColorStop(0.4,rgba(210,175,135,0.18));
    hor.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=hor; ctx.fillRect(0,0,W,H);

    // 3. Faint stars emerging
    ctx.save();
    MOTES.forEach((m,i)=>{
      if(i>30||m.y>0.55)return;
      const fl=Math.max(0,Math.sin(t*m.spd*0.6+m.ph)*0.5+0.5);
      ctx.beginPath(); ctx.arc(m.x*W,m.y*H*0.55,m.sz*0.55,0,Math.PI*2);
      ctx.fillStyle=`rgba(240,235,255,${fl*0.50})`;
      ctx.fill();
    });
    ctx.restore();

    // 4. Layered hills — darkening towards foreground
    ctx.save();
    // far hill
    ctx.fillStyle=rgba(128,115,148,0.38);
    ctx.beginPath(); ctx.moveTo(0,H);
    [0,0.20,0.42,0.62,0.80,0.95,1.0].forEach((px,i)=>{
      ctx.lineTo(W*px+mx*4,[0.84,0.62,0.70,0.56,0.65,0.68,0.84][i]*H);
    });
    ctx.lineTo(W,H); ctx.closePath(); ctx.fill();
    // mid hill
    ctx.fillStyle=rgba(105,92,125,0.48);
    ctx.beginPath(); ctx.moveTo(0,H);
    [0,0.14,0.30,0.48,0.65,0.82,1.0].forEach((px,i)=>{
      ctx.lineTo(W*px+mx*7,[0.92,0.72,0.80,0.65,0.74,0.78,0.92][i]*H);
    });
    ctx.lineTo(W,H); ctx.closePath(); ctx.fill();
    // near ground
    ctx.fillStyle=rgba(80,68,98,0.55);
    ctx.beginPath(); ctx.moveTo(0,H);
    [0,0.25,0.50,0.75,1.0].forEach((px,i)=>{
      ctx.lineTo(W*px+mx*9,[0.95,0.88,0.91,0.87,0.95][i]*H);
    });
    ctx.lineTo(W,H); ctx.closePath(); ctx.fill();
    ctx.restore();

    // 5. Lavender field texture on near hill
    ctx.save();
    for(let lv=0;lv<50;lv++){
      const lx=W*(lv/50)+Math.sin(t*0.000018+lv*0.55)*W*0.004+mx*9;
      const ly=H*(0.88+((lv*23)%5)*0.018);
      const lh=H*(0.018+((lv*11)%4)*0.006);
      const sway=Math.sin(t*0.000025+lv*0.62)*W*0.004;
      ctx.strokeStyle=`rgba(130,108,158,${0.22+((lv*7)%4)*0.04})`;
      ctx.lineWidth=1.0;
      ctx.beginPath();
      ctx.moveTo(lx,ly+lh);
      ctx.quadraticCurveTo(lx+sway*0.5,ly+lh*0.4,lx+sway,ly);
      ctx.stroke();
    }
    ctx.restore();

    // 6. Fireflies — pulsing glow dots
    ctx.save();
    for(let f=0;f<22;f++){
      const fx=W*(0.04+(f*73.3)%0.92)+Math.sin(t*0.000048+f*1.2)*W*0.028+mx*12;
      const fy=H*(0.50+(f*41.1)%0.42)+Math.cos(t*0.000038+f*0.9)*H*0.038;
      const fa=Math.max(0,Math.sin(t*0.00110+f*2.0))*0.70;
      if(fa<0.05)continue;
      const fg=ctx.createRadialGradient(fx,fy,0,fx,fy,7);
      fg.addColorStop(0,`rgba(200,240,160,${fa})`);
      fg.addColorStop(0.5,`rgba(160,210,100,${fa*0.4})`);
      fg.addColorStop(1,'rgba(0,0,0,0)');
      ctx.fillStyle=fg; ctx.beginPath(); ctx.arc(fx,fy,7,0,Math.PI*2); ctx.fill();
    }
    ctx.restore();

    // 7. Ground mist — lilac toned
    const mist=[
      {col:rgba(178,168,198,0.22),a:0.020,f:0.0010,sp:0.000036,y:0.80},
      {col:rgba(185,175,205,0.16),a:0.014,f:0.0014,sp:0.000026,y:0.87},
      {col:rgba(192,183,212,0.12),a:0.011,f:0.0008,sp:0.000042,y:0.93},
    ];
    mist.forEach((w,i)=>{
      const by=H*w.y+my*10;
      ctx.beginPath(); ctx.moveTo(0,H);
      for(let x=0;x<=W;x+=3){
        const y=by+Math.sin(x*w.f+t*w.sp*1000+i)*H*w.a;
        ctx.lineTo(x,y);
      }
      ctx.lineTo(W,H); ctx.closePath();
      ctx.fillStyle=w.col; ctx.fill();
    });

    // 8. Atmospheric violet haze
    const haze=ctx.createLinearGradient(0,H*0.50,0,H*0.72);
    haze.addColorStop(0,'rgba(0,0,0,0)');
    haze.addColorStop(0.5,rgba(148,128,175,0.10));
    haze.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=haze; ctx.fillRect(0,0,W,H);
  }
},
]; // end THEMES

// ══════════════════════════════════════════════════════════════
// DOM
// ══════════════════════════════════════════════════════════════
const canvases=[0,1,2,3,4].map(i=>document.getElementById('c'+i));
const ctxs=canvases.map(c=>c.getContext('2d'));
const pLayers=[0,1,2,3,4].map(i=>document.getElementById('p'+i));
const blobs=[0,1,2,3,4].map(i=>document.getElementById('b'+i));
const bc=document.getElementById('bc');
const brs=document.querySelectorAll('.br');
const veil=document.getElementById('veil');

let idx=0, theme=THEMES[0];
let W=innerWidth,H=innerHeight,t=0;
let mx=0,my=0,tmx=0,tmy=0;

function resize(){
  W=innerWidth; H=innerHeight;
  canvases.forEach(c=>{c.width=W;c.height=H});
}
resize(); addEventListener('resize',resize);

const BD=[
  {phx:0.0,phy:1.3,spx:0.000072,spy:0.000055,sA:0.08},
  {phx:2.0,phy:0.5,spx:0.000055,spy:0.000085,sA:0.07},
  {phx:4.2,phy:3.1,spx:0.000085,spy:0.000065,sA:0.09},
  {phx:1.1,phy:5.2,spx:0.000065,spy:0.000075,sA:0.07},
  {phx:3.3,phy:2.4,spx:0.000078,spy:0.000046,sA:0.10},
];
function tickBlobs(){
  blobs.forEach((b,i)=>{
    const d=BD[i];
    const dx=Math.sin(t*d.spx+d.phx)*4.5;
    const dy=Math.cos(t*d.spy+d.phy)*3.5;
    const sc=1+Math.sin(t*d.spx*0.58+d.phx*1.4)*d.sA;
    b.style.transform=`translate(${dx+mx*7}vw,${dy+my*4.5}vh) scale(${sc})`;
  });
}

// ══════════════════════════════════════════════════════════════
// PARTICLES
// ══════════════════════════════════════════════════════════════
const pIntervals=[];

// 0 Sakura Twilight — falling petals + pollen wisps
function spawnSakura(c){
  const el=document.createElement('div');
  if(Math.random()<0.65){
    const sz=6+Math.random()*16;
    const dur=12+Math.random()*16;
    const anim=Math.random()<0.55?'petalFall':'petalDrift';
    const hue=330+Math.random()*35;
    Object.assign(el.style,{position:'absolute',
      width:sz+'px',height:sz*0.46+'px',
      borderRadius:'50% 50% 0 50%',
      left:Math.random()*96+'%',top:'-3%',
      background:`hsla(${hue},42%,72%,${0.55+Math.random()*0.32})`,
      filter:'blur(0.5px)',
      animation:`${anim} ${dur}s ease-in forwards`,
      transform:`rotate(${Math.random()*360}deg)`,opacity:0});
  } else {
    const sz=1.5+Math.random()*3.5;
    const dur=16+Math.random()*18;
    Object.assign(el.style,{position:'absolute',borderRadius:'50%',
      width:sz+'px',height:sz+'px',
      left:(5+Math.random()*90)+'%',top:(Math.random()*75)+'%',
      background:`rgba(205,172,182,${0.45+Math.random()*0.35})`,
      animation:`driftMote ${dur}s ease-in-out forwards`,opacity:0});
  }
  c.appendChild(el);
  setTimeout(()=>el.remove(),(parseFloat(el.style.animationDuration||'14')+1)*1000);
}

// 1 Misty Forest — spores + leaf fragments + mist wisps
function spawnForest(c){
  const el=document.createElement('div');
  const r=Math.random();
  if(r<0.45){
    const sz=2+Math.random()*5;
    const dur=18+Math.random()*22;
    const hue=100+Math.random()*45;
    Object.assign(el.style,{position:'absolute',borderRadius:'50%',
      width:sz+'px',height:sz+'px',
      left:(5+Math.random()*90)+'%',bottom:(Math.random()*38)+'%',
      background:`hsla(${hue},38%,52%,${0.45+Math.random()*0.35})`,
      boxShadow:`0 0 ${sz*3}px hsla(${hue},45%,48%,0.25)`,
      filter:'blur(0.6px)',
      animation:`sporeRise ${dur}s ease-in-out forwards`,opacity:0});
  } else if(r<0.72){
    const sz=7+Math.random()*15;
    const dur=12+Math.random()*16;
    const hue=105+Math.random()*35;
    Object.assign(el.style,{position:'absolute',
      width:sz+'px',height:sz*0.52+'px',
      borderRadius:'50% 0 50% 0',
      left:Math.random()*95+'%',top:'-3%',
      background:`hsla(${hue},38%,40%,${0.35+Math.random()*0.30})`,
      animation:`leafSpin ${dur}s ease-in forwards`,
      transform:`rotate(${Math.random()*360}deg)`,opacity:0});
  } else {
    const sz=18+Math.random()*36;
    const dur=20+Math.random()*24;
    Object.assign(el.style,{position:'absolute',borderRadius:'50%',
      width:sz+'px',height:sz*0.38+'px',
      left:(Math.random()*88)+'%',bottom:(Math.random()*32)+'%',
      background:`rgba(185,200,180,${0.10+Math.random()*0.12})`,
      filter:'blur(5px)',
      animation:`floatUp ${dur}s ease-in-out forwards`,opacity:0});
  }
  c.appendChild(el);
  setTimeout(()=>el.remove(),(parseFloat(el.style.animationDuration||'18')+1)*1000);
}

// 2 Amber Autumn — spinning leaves + ember-like motes
function spawnAutumn(c){
  const el=document.createElement('div');
  if(Math.random()<0.60){
    const sz=8+Math.random()*20;
    const dur=10+Math.random()*16;
    const hue=15+Math.random()*35;
    const sat=45+Math.random()*20;
    const lit=38+Math.random()*18;
    Object.assign(el.style,{position:'absolute',
      width:sz+'px',height:sz*0.55+'px',
      borderRadius:'50% 0 50% 0',
      left:Math.random()*96+'%',top:'-3%',
      background:`hsla(${hue},${sat}%,${lit}%,${0.50+Math.random()*0.32})`,
      filter:'blur(0.4px)',
      animation:`leafSpin ${dur}s ease-in forwards`,
      transform:`rotate(${Math.random()*360}deg)`,opacity:0});
  } else {
    const sz=2+Math.random()*5;
    const dur=14+Math.random()*18;
    const hue=30+Math.random()*25;
    Object.assign(el.style,{position:'absolute',borderRadius:'50%',
      width:sz+'px',height:sz+'px',
      left:(5+Math.random()*90)+'%',bottom:(Math.random()*50)+'%',
      background:`hsla(${hue},55%,55%,${0.45+Math.random()*0.38})`,
      boxShadow:`0 0 ${sz*3}px hsla(${hue},60%,50%,0.3)`,
      animation:`emberFloat ${dur}s ease-out forwards`,opacity:0});
  }
  c.appendChild(el);
  setTimeout(()=>el.remove(),(parseFloat(el.style.animationDuration||'14')+1)*1000);
}

// 3 Silver Rain — raindrops + ripples + mist wisps
function spawnRain(c){
  const el=document.createElement('div');
  const r=Math.random();
  if(r<0.48){
    const w=0.8,h=10+Math.random()*24;
    const dur=0.7+Math.random()*1.2;
    Object.assign(el.style,{position:'absolute',
      width:w+'px',height:h+'px',
      left:(2+Math.random()*96)+'%',top:'-2%',
      background:'linear-gradient(to bottom,rgba(138,162,192,0),rgba(138,162,192,0.55),rgba(138,162,192,0))',
      animation:`raindrop ${dur}s linear forwards`,opacity:0});
  } else if(r<0.72){
    const sz=5+Math.random()*9;
    const dur=2.2+Math.random()*2.8;
    Object.assign(el.style,{position:'absolute',
      width:sz+'px',height:sz*0.32+'px',
      borderRadius:'50%',
      border:'1px solid rgba(115,148,182,0.40)',
      left:(5+Math.random()*88)+'%',top:(68+Math.random()*26)+'%',
      animation:`rippleOut ${dur}s ease-out forwards`,opacity:0});
  } else {
    const sz=16+Math.random()*32;
    const dur=14+Math.random()*18;
    Object.assign(el.style,{position:'absolute',borderRadius:'50%',
      width:sz+'px',height:sz*0.38+'px',
      left:(Math.random()*88)+'%',bottom:(Math.random()*38)+'%',
      background:`rgba(168,188,212,${0.08+Math.random()*0.10})`,
      filter:'blur(5px)',
      animation:`floatUp ${dur}s ease-in-out forwards`,opacity:0});
  }
  c.appendChild(el);
  setTimeout(()=>el.remove(),(parseFloat(el.style.animationDuration||'8')+1)*1000);
}

// 4 Lavender Dusk — firefly glows + pollen + tiny moths
function spawnDusk(c){
  const el=document.createElement('div');
  const r=Math.random();
  if(r<0.45){
    // firefly — small glowing dot
    const sz=3+Math.random()*5;
    const dur=12+Math.random()*18;
    Object.assign(el.style,{position:'absolute',borderRadius:'50%',
      width:sz+'px',height:sz+'px',
      left:(4+Math.random()*92)+'%',
      top:(30+Math.random()*58)+'%',
      background:`rgba(190,230,140,${0.55+Math.random()*0.38})`,
      boxShadow:`0 0 ${sz*5}px rgba(175,225,120,0.55)`,
      filter:'blur(0.6px)',
      animation:`driftMote ${dur}s ease-in-out forwards`,opacity:0});
  } else if(r<0.72){
    // pollen mote
    const sz=1.5+Math.random()*3;
    const dur=16+Math.random()*20;
    Object.assign(el.style,{position:'absolute',borderRadius:'50%',
      width:sz+'px',height:sz+'px',
      left:(5+Math.random()*90)+'%',
      top:(Math.random()*80)+'%',
      background:`rgba(185,165,210,${0.40+Math.random()*0.35})`,
      animation:`driftMote ${dur}s ease-in-out forwards`,opacity:0});
  } else {
    // moth — small rectangle with soft blur
    const sz=5+Math.random()*10;
    const dur=14+Math.random()*18;
    Object.assign(el.style,{position:'absolute',
      width:sz+'px',height:sz*0.35+'px',
      borderRadius:'50%',
      left:(5+Math.random()*90)+'%',
      top:(20+Math.random()*60)+'%',
      background:`rgba(220,210,235,${0.30+Math.random()*0.25})`,
      filter:'blur(1px)',
      animation:`driftMote ${dur}s ease-in-out forwards`,opacity:0});
  }
  c.appendChild(el);
  setTimeout(()=>el.remove(),(parseFloat(el.style.animationDuration||'16')+1)*1000);
}

const SPAWN_FNS=[spawnSakura,spawnForest,spawnAutumn,spawnRain,spawnDusk];
const SPAWN_RATES=[900,1100,800,400,1000];
const SPAWN_BURST=[10,11,10,14,10];

function startParticles(ti){
  for(let i=0;i<SPAWN_BURST[ti];i++)
    setTimeout(()=>SPAWN_FNS[ti](pLayers[ti]),i*170);
  const iv=setInterval(()=>SPAWN_FNS[ti](pLayers[ti]),SPAWN_RATES[ti]);
  pIntervals.push({ti,iv});
}
function stopParticles(ti){
  for(let i=pIntervals.length-1;i>=0;i--){
    if(pIntervals[i].ti===ti){clearInterval(pIntervals[i].iv);pIntervals.splice(i,1);}
  }
}

function applyTheme(th,i){
  document.body.style.background=th.bg;
  blobs.forEach((b,bi)=>{
    const pos=th.blobPos[bi];
    b.style.background=`radial-gradient(circle,${th.blobs[bi]} 0%,transparent 70%)`;
    b.style.width=th.blobSizes[bi]; b.style.height=th.blobSizes[bi];
    b.style.top=pos.top||'unset'; b.style.left=pos.left||'unset';
    b.style.right=pos.right||'unset'; b.style.bottom=pos.bottom||'unset';
  });
  bc.style.background=th.dotColor;
  bc.style.boxShadow=`0 0 26px ${th.dotGlow},0 0 50px ${th.dotGlow}`;
  brs.forEach(r=>r.style.borderColor=th.ringColor);
  canvases.forEach((cv,ci)=>cv.style.opacity=ci===i?'1':'0');
  pLayers.forEach((p,pi)=>p.style.opacity=pi===i?'1':'0');
}

const HOLD=22000, FADE=3200;
function nextTheme(){
  veil.classList.add('fade');
  const prev=idx;
  setTimeout(()=>{
    stopParticles(prev);
    idx=(idx+1)%THEMES.length;
    theme=THEMES[idx];
    applyTheme(theme,idx);
    startParticles(idx);
    setTimeout(()=>veil.classList.remove('fade'),420);
  },FADE*0.50);
}
setInterval(nextTheme,HOLD);
applyTheme(theme,0);
startParticles(0);

function loop(ts){
  t=ts;
  mx+=(tmx-mx)*0.028;
  my+=(tmy-my)*0.028;
  theme.drawFn(ctxs[idx],W,H,t,mx,my);
  tickBlobs();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

addEventListener('mousemove',e=>{
  tmx=(e.clientX/innerWidth-0.5)*2;
  tmy=(e.clientY/innerHeight-0.5)*2;
});
</script>
</body>
</html>
